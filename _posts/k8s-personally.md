# Docker-compose 대신 Kubernetes 

## Introduction 

- 이 포스팅은 
    + 쿠버네티스에 관한 일반적인 해설, 설정 소개 등이 아닙니다. 
    + 개발환경 일반을 다루지 않습니다. 

- 이 포스팅은 
    + 도커-컴포즈 대신 쿠버네티스를 컨테이터 관리 툴로 사용한 경험을 기술합니다. 
    + 데이터 관련 프로그램만 제한적으로 다룰 예정입니다. 

## Alternatives 

### Why

#### Without docker 

도커가 여러 문제점이 있지만 개인 툴로써 쓰기에는 큰 불편함이 없다. 하지만 도커 데스크탑 앱이 유료화된 후로 왠지 쓰기에 찜찜해진 것은 사실이다. 유료화 그리고 많은 오픈소스 기반 쿠버네티스 진영의 컨테이너 기본 툴 변경 등등을 무시하기도 힘들다. 

컨테이너 도구로서 도커를 버린다고 해도, 버리기 힘든 도구가 도커-콤포즈다. 부팅이 잦은 데스크 탑에서 필요한 툴을 불러와서 각종 설정을 매번 도커로 해줄 수는 없다. 이떄 도커-콤포즈로 설정을 맞춰고 한방에 띄우면 제법 깔끔하게 쓸 수 있다. 도커-콤포즈를 꼭 도커와 써야하는 것은 아니다. 앞서 소개한 내용처럼 podman과 합쳐서 쓸 수도 있다. 그래도 궁금했다. 도커-콤포즈 없이 컨테이너를 관리할 수는 없을까? 

#### Across Os 

다른 문제 하나는 운영 체제간 호환성이다. 윈도에서 WSL를 통해 리눅스를 쓰게 되면서 운영 체제를 가리지 않는 개발 도구(분석 도구) 운영이 가능해졌다. 다만 여기에도 미묘한 차이는 있다. WSL은 서비스 매니저로 systemd를 쓰지 않기 때문에 systemd에 의존하는 도커-콤포즈를 쓰기 위해서는 별도의 설정이 필요하다. 이런 것 없이 윈도우, mac os, 리눅스를 두루 걸쳐서 쓸 수 없을까? 

### Alternative 1: nerdctl 

도커의 명령어와 거의 완벽하게 호환되면서도 도커-컴포즈의 기능까지 구현한 오픈소스 프로젝트가 Cotainerd 표준 기반의 [nerdctl](https://github.com/containerd/nerdctl)이다. 페이지에서 확인하듯이 도커 및 도커-콤포즈의 거의 모든 명령어가 호환되며 모든 OS를 가리지 않고 쓸 수 있다. nerdctl로 거의 모든 것이 해결될 것 같았으나, 그렇지 않았다. 

도커 리포지토리인 도커 허브의 이미지에 따라서 nerdctl에서 제대로 작동하지 않는 녀석들이 있다. 아마도 원래 이미지 자체가 도커에 특화된 것이 아닐까 추측해보지만, 이걸 다 짚으면서 빌드를 할 여유가 있지는 않았다. 

### Alternative 2: Kuberntes 

다음 후보로 컨테이너 오케스트레이션 도구인 쿠버네티스에 눈을 돌렸다. 사실 쿠버네티스를 이 용도로 쓰는 것은 닭 잡는데 소 잡는 칼을 쓰는 격이다. 쿠버네티스를 배운다는 개인적인 욕심이 있긴 했지만, 이걸 꼭 써야 하나?

그떄 만난 것이 Rancher Desk! 리눅스 배포판을 만드는 회사인 SUSE에서 내 놓은 경량화된 쿠버네티스(K3s) 앱인데, 이 녀석이 아주 쓸만 했다. 원래는 nerdctl을 좀 편하게 써볼까 하는 용도로 설치했는데 사용성이 좋았다.

- 사용자 경험이 Docker Desktop과 비슷하다. 사용자는 OS별로 설치하면 커맨드라인 툴에 알아서 잘 돌아간다. Windows(파워셀), WSL2, M1 기반의 macos에서 거의 동일한 경험을 제공한다. 

- 경량화된 쿠버네티스가 들어 있어서 minikube를 별도로 설치하지 않고 데스크탑에서 쉽게 쿠버네티스를 활용할 수 있다. 부팅 후에도 원래 올려 놓은 쿠버네티스 설정을 유지하고 있어서 개인용 PC에서 쓰기에도 적합하다. 

- GUI를 갖추고 있다. 


## Using Kubernetes 


### Image build 

### Pull and run 

